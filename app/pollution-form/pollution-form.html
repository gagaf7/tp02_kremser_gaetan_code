<form [formGroup]="form" (ngSubmit)="submitDeclaration()" class="form" novalidate aria-labelledby="form-title">
  <h2 id="form-title" class="visually-hidden">Formulaire de déclaration de pollution</h2>

  <div class="row">
    <label for="titre">Titre *</label>
    <input id="titre" formControlName="titre" aria-required="true" [attr.aria-invalid]="formControls['titre'].invalid && (formControls['titre'].touched || formControls['titre'].dirty)"/>
    <div class="error" role="alert" *ngIf="formControls['titre'].touched && formControls['titre'].invalid">Titre requis.</div>
  </div>

  <div class="row">
    <label for="type">Type *</label>
    <select id="type" formControlName="type" aria-required="true" [attr.aria-invalid]="formControls['type'].invalid && (formControls['type'].touched || formControls['type'].dirty)">
      <option value="">-- choisir --</option>
      <option *ngFor="let t of types" [value]="t">{{ t }}</option>
    </select>
    <div class="error" role="alert" *ngIf="formControls['type'].touched && formControls['type'].invalid">Type requis.</div>
  </div>

  <div class="row">
    <label for="description">Description *</label>
    <textarea id="description" formControlName="description" rows="4" aria-required="true"></textarea>
    <div class="error" role="alert" *ngIf="formControls['description'].touched && formControls['description'].invalid">Description requise.</div>
  </div>

  <div class="row">
    <label for="dateObservation">Date d'observation *</label>
    <input id="dateObservation" type="date" formControlName="dateObservation" aria-required="true" [attr.max]="today"/>
    <div class="error" role="alert" *ngIf="formControls['dateObservation'].touched && formControls['dateObservation'].invalid">Date requise ou invalide.</div>
  </div>

  <div class="row">
    <label for="lieu">Lieu *</label>
    <input id="lieu" formControlName="lieu" aria-required="true"/>
    <div class="error" role="alert" *ngIf="formControls['lieu'].touched && formControls['lieu'].invalid">Lieu requis.</div>
  </div>

  <div class="row two-cols">
    <div>
      <label for="latitude">Latitude *</label>
      <input id="latitude" formControlName="latitude" inputmode="decimal" aria-required="true" [attr.aria-invalid]="formControls['latitude'].invalid && (formControls['latitude'].touched || formControls['latitude'].dirty)"/>
      <div class="error" role="alert" *ngIf="formControls['latitude'].touched && formControls['latitude'].invalid">Latitude invalide (‑90 à 90).</div>
    </div>
    <div>
      <label for="longitude">Longitude *</label>
      <input id="longitude" formControlName="longitude" inputmode="decimal" aria-required="true" [attr.aria-invalid]="formControls['longitude'].invalid && (formControls['longitude'].touched || formControls['longitude'].dirty)"/>
      <div class="error" role="alert" *ngIf="formControls['longitude'].touched && formControls['longitude'].invalid">Longitude invalide (‑180 à 180).</div>
    </div>
  </div>

  <div class="row">
    <label for="photoUrl">Photo (URL)</label>
    <input id="photoUrl" formControlName="photoUrl" placeholder="https://..." aria-describedby="photo-help"/>
    <div id="photo-help" class="muted">Optionnel — fournissez une URL publique pour afficher la photo.</div>
  </div>

  <div class="actions">
    <button type="submit" [disabled]="form.invalid" title="Déclarer" aria-disabled="{{form.invalid}}">Déclarer</button>
  </div>
</form>